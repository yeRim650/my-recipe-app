# ğŸ³ Recipe App Docker ë°°í¬ ê°€ì´ë“œ

> Frontend + Backend í†µí•© Docker ë°°í¬ ì„¤ì •

## ğŸ“‹ ë³€ê²½ì‚¬í•­ ìš”ì•½

### ğŸ†• ìƒˆë¡œ ì¶”ê°€ëœ íŒŒì¼
- `docker-compose.yml` - ì „ì²´ ì•± í†µí•© compose íŒŒì¼
- `frontend/Dockerfile` - Next.js í”„ë¡ íŠ¸ì—”ë“œìš© Docker ì„¤ì •
- `nginx.conf` - ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì • (ì„ íƒì‚¬í•­)

### ğŸ”„ ìˆ˜ì •ëœ íŒŒì¼
- `frontend/next.config.mjs` - standalone ì¶œë ¥ ëª¨ë“œ ë° API í”„ë¡ì‹œ ì„¤ì • ì¶”ê°€

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Docker Network                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Nginx     â”‚  â”‚   Frontend   â”‚  â”‚      Backend        â”‚ â”‚
â”‚  â”‚ (Port: 80)  â”‚  â”‚ (Port: 3000) â”‚  â”‚   (Port: 8000)     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                     â”‚
â”‚  â”‚   MySQL     â”‚  â”‚   Qdrant     â”‚  â”‚                     â”‚
â”‚  â”‚ (Port: 3307)â”‚  â”‚ (Port: 6201) â”‚  â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ ë°°í¬ ë°©ë²•

### 1. ê¸°ë³¸ ì‹¤í–‰ (ì¶”ì²œ)
ì „ì²´ ìŠ¤íƒì„ ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰:

```bash
# ëª¨ë“  ì„œë¹„ìŠ¤ ì‹¤í–‰
docker-compose up -d

# ë¡œê·¸ í™•ì¸
docker-compose logs -f

# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
docker-compose ps
```

**ì ‘ì†:**
- í”„ë¡ íŠ¸ì—”ë“œ: http://localhost:3000
- ë°±ì—”ë“œ API: http://localhost:8000
- MySQL: localhost:3307
- Qdrant: http://localhost:6201

### 2. Nginx í†µí•© ì‹¤í–‰ (ì„ íƒì‚¬í•­)
í•˜ë‚˜ì˜ ë„ë©”ì¸ì—ì„œ ëª¨ë“  ì„œë¹„ìŠ¤ ì ‘ê·¼:

```bash
# Nginx í¬í•¨ ì‹¤í–‰
docker-compose --profile nginx up -d
```

**ì ‘ì†:**
- í†µí•© ì•±: http://localhost (í”„ë¡ íŠ¸ì—”ë“œ + API ëª¨ë‘)

### 3. ë°ì´í„° ì´ˆê¸°í™”
ì²˜ìŒ ì‹¤í–‰ ì‹œ ë˜ëŠ” ë°ì´í„° ë¦¬ì…‹ì´ í•„ìš”í•  ë•Œ:

```bash
# ë°ì´í„° ì´ˆê¸°í™” ì‹¤í–‰
docker-compose --profile init up init-data

# ì´ˆê¸°í™” ë¡œê·¸ í™•ì¸
docker-compose --profile init logs init-data
```

## ğŸ”§ ê°œë°œ vs ìš´ì˜ í™˜ê²½

### ê°œë°œ í™˜ê²½
```bash
# Backendë§Œ ì‹¤í–‰ (ê¸°ì¡´ ë°©ì‹)
cd backend
docker-compose up -d

# Frontend ë¡œì»¬ ì‹¤í–‰
cd frontend
pnpm dev
```

### ìš´ì˜ í™˜ê²½
```bash
# ë£¨íŠ¸ì—ì„œ ì „ì²´ ì•± ì‹¤í–‰
docker-compose up -d
```

## ğŸ“ íŒŒì¼ë³„ ìƒì„¸ ì„¤ëª…

### 1. `docker-compose.yml` (ë£¨íŠ¸)
- **ëª©ì **: ì „ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ í†µí•© ë°°í¬
- **ì„œë¹„ìŠ¤**: frontend, backend, mysql, qdrant, nginx, init-data
- **ë„¤íŠ¸ì›Œí¬**: recipe-networkë¡œ ì„œë¹„ìŠ¤ ê°„ í†µì‹ 
- **ë³¼ë¥¨**: ë°ì´í„° ì˜ì†ì„± ë³´ì¥

### 2. `frontend/Dockerfile`
- **ë² ì´ìŠ¤ ì´ë¯¸ì§€**: node:20-alpine
- **ë¹Œë“œ ë°©ì‹**: Multi-stage build (deps â†’ builder â†’ runner)
- **ìµœì í™”**: 
  - pnpm ì‚¬ìš©ìœ¼ë¡œ ë¹ ë¥¸ ì˜ì¡´ì„± ì„¤ì¹˜
  - standalone ì¶œë ¥ìœ¼ë¡œ ìµœì†Œ ëŸ°íƒ€ì„
  - ë¹„root ì‚¬ìš©ì (nextjs) ì‹¤í–‰

### 3. `frontend/next.config.mjs`
- **ì¶”ê°€ ì„¤ì •**:
  - `output: 'standalone'` - Docker ìµœì í™”
  - API í”„ë¡ì‹œ ì„¤ì • (ê°œë°œ/ìš´ì˜ í™˜ê²½ ìë™ ê°ì§€)

### 4. `nginx.conf`
- **ì—­í• **: ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ë° ë¡œë“œë°¸ëŸ°ì„œ
- **ë¼ìš°íŒ…**:
  - `/` â†’ Frontend (Next.js)
  - `/api/` â†’ Backend (FastAPI)
  - `/ws` â†’ WebSocket ì§€ì›

## ğŸ› ï¸ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

í™˜ê²½ ë³€ìˆ˜ê°€ í•„ìš”í•œ ê²½ìš° `.env` íŒŒì¼ ìƒì„±:

```env
# API Keys
FOOD_SAFETY_API_KEY=your_api_key_here
OPENAI_API_KEY=your_openai_key_here

# Database
MYSQL_ROOT_PASSWORD=1234
MYSQL_DATABASE=cookwise

# Environment
ENV=production
NODE_ENV=production
```

## ğŸ› íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. í¬íŠ¸ ì¶©ëŒ
```bash
# ì‚¬ìš© ì¤‘ì¸ í¬íŠ¸ í™•ì¸
netstat -an | findstr "3000\|8000\|3307\|6201"

# ë‹¤ë¥¸ í¬íŠ¸ë¡œ ë³€ê²½í•˜ê±°ë‚˜ ê¸°ì¡´ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ
```

### 2. ì»¨í…Œì´ë„ˆ ë¹Œë“œ ì‹¤íŒ¨
```bash
# ìºì‹œ ì—†ì´ ë‹¤ì‹œ ë¹Œë“œ
docker-compose build --no-cache

# ê°œë³„ ì„œë¹„ìŠ¤ ë¹Œë“œ
docker-compose build frontend
docker-compose build backend
```

### 3. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜
```bash
# MySQL ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
docker-compose logs mysql

# í—¬ìŠ¤ì²´í¬ ìƒíƒœ í™•ì¸
docker-compose ps
```

### 4. ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ
```bash
# ë„¤íŠ¸ì›Œí¬ ì •ë¦¬
docker network prune

# ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
docker-compose down && docker-compose up -d
```

## ğŸ”„ ìœ ì§€ë³´ìˆ˜ ëª…ë ¹ì–´

### ì‹œì‘/ì¤‘ì§€
```bash
# ì „ì²´ ì„œë¹„ìŠ¤ ì‹œì‘
docker-compose up -d

# ì „ì²´ ì„œë¹„ìŠ¤ ì¤‘ì§€
docker-compose down

# ë³¼ë¥¨ê¹Œì§€ ì‚­ì œ (ë°ì´í„° ì´ˆê¸°í™”)
docker-compose down -v
```

### ë¡œê·¸ ë° ëª¨ë‹ˆí„°ë§
```bash
# ì „ì²´ ë¡œê·¸
docker-compose logs -f

# íŠ¹ì • ì„œë¹„ìŠ¤ ë¡œê·¸
docker-compose logs -f frontend
docker-compose logs -f backend

# ì‹¤ì‹œê°„ ìƒíƒœ ëª¨ë‹ˆí„°ë§
watch docker-compose ps
```

### ì—…ë°ì´íŠ¸
```bash
# ì½”ë“œ ë³€ê²½ í›„ ë‹¤ì‹œ ë¹Œë“œ
docker-compose build
docker-compose up -d

# íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ì¬ë¹Œë“œ
docker-compose build frontend
docker-compose up -d frontend
```

## ğŸ“Š ì„±ëŠ¥ ìµœì í™” íŒ

1. **ì´ë¯¸ì§€ í¬ê¸° ìµœì í™”**
   - Multi-stage build í™œìš©
   - Alpine Linux ë² ì´ìŠ¤ ì´ë¯¸ì§€ ì‚¬ìš©
   - .dockerignore íŒŒì¼ë¡œ ë¶ˆí•„ìš”í•œ íŒŒì¼ ì œì™¸

2. **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì œí•œ**
   ```yaml
   deploy:
     resources:
       limits:
         memory: 512M
   ```

3. **í—¬ìŠ¤ì²´í¬ í™œìš©**
   - ì„œë¹„ìŠ¤ ìƒíƒœ ìë™ ëª¨ë‹ˆí„°ë§
   - ì˜ì¡´ì„± ê´€ë¦¬ë¡œ ì•ˆì •ì ì¸ ì‹œì‘ ìˆœì„œ

## ğŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **í™˜ê²½ ë³€ìˆ˜ ë³´ì•ˆ**
   - `.env` íŒŒì¼ì„ gitì— ì»¤ë°‹í•˜ì§€ ì•Šê¸°
   - ë¯¼ê°í•œ ì •ë³´ëŠ” Docker secrets ì‚¬ìš© ê³ ë ¤

2. **ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ**
   - ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ ì‚¬ìš©ìœ¼ë¡œ ì„œë¹„ìŠ¤ ê°„ í†µì‹  ê²©ë¦¬
   - í•„ìš”í•œ í¬íŠ¸ë§Œ ì™¸ë¶€ ë…¸ì¶œ

3. **ì»¨í…Œì´ë„ˆ ë³´ì•ˆ**
   - ë¹„root ì‚¬ìš©ìë¡œ ì‹¤í–‰
   - ìµœì†Œ ê¶Œí•œ ì›ì¹™ ì ìš©

---

**ì‘ì„±ì¼**: 2024ë…„ 12ì›”
**ë²„ì „**: v1.0
**ì‘ì„±ì**: jyr 